<!doctype html>
<html>

<head>
    <title>JavaScript</title>
    <style>
        .ready {
            background-color: #ddd;
            color: red;
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <div class="main">
        <input placeholder="New Item" value="test item" maxlength="30">
        <button class="add">Add</button>
        <button class="clear">Clear</button>
    </div>
    <ul class="output">
    </ul>
    <script>
        const main = document.querySelector('.main');
        const input = document.querySelector('input');
        const btnAdd = document.querySelector('.add');
        const btnClear = document.querySelector('.clear');
        const output = document.querySelector('.output');

        let tasks = [];

        if (window.localStorage.getItem("tasklist")) {
            tasks = JSON.parse(window.localStorage.getItem("tasklist"));
        }

        tasks.forEach(task => {
            addListItem(task.text, task.checked)            
        });

        btnAdd.addEventListener("click", e => {
            addListItem(input.value)
        });

        btnClear.addEventListener("click", e => {
            window.localStorage.removeItem("tasklist");
            output.innerHTML = "";
        })

        function addListItem(text, checked) {
            const li = document.createElement("li");
            const textNode = document.createTextNode(text);
            li.append(textNode);
            if (checked)
                li.classList.add('ready');
            li.addEventListener("click", e => {
                e.target.classList.toggle('ready');                
            });
            output.append(li);                        
            taskBuilder();
        }
        
        function taskBuilder() {
            tasks = [];
            let checked = false;

            const liAll = document.querySelectorAll('li');
            liAll.forEach(li => {
                const text = li.textContent;
                let checked = false;
                if (li.classList.contains('ready')) {
                    checked = true;
                }
                const obj = {text:text, checked:checked};
                tasks.push(obj);
            });
            saveTasks();
        }

        function saveTasks() {
            window.localStorage.setItem("tasklist", JSON.stringify(tasks));
        }

    </script>
</body>

</html>